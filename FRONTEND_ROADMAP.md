# Frontend Development Roadmap
## Benjamin's Chili Oil - PWA Architecture

**Last Updated:** 2025-10-25
**Architecture:** Hybrid (Admin SSR + Store Manager PWA)

---

## ✅ **Completed (Phase 1A - Admin UI)**

### Core Inventory Management
- [x] Inventory Dashboard (`/inventory`)
  - Real-time stock levels across 10 stores
  - Dashboard statistics cards
  - Advanced filtering (status, region, search, restock need)
  - Sortable table with comprehensive columns
  - Visual status indicators (Critical, Low, Healthy)
  - Restock trigger visualization
  - Sales velocity projection
  - Suggested restock quantities
  - Batch selection capability

- [x] Batch Stock Update
  - Modal for updating multiple stores
  - Three modes: Set To, Add, Subtract
  - Impact preview
  - Audit trail with reason tracking

- [x] Stock Transfer System (`/transfers/new`)
  - From/To location selection
  - Smart quantity suggestions
  - Transfer types (Scheduled, Emergency, Adjustment)
  - Stock level preview
  - Value calculations
  - Delivery notes

- [x] Alert Approval System (`/alerts/pending`)
  - Pending alerts queue with priority filtering
  - Message preview with character count
  - Context data display
  - Individual actions (Approve, Reject, Edit, Schedule)
  - Bulk approve functionality
  - Alert types (Critical, Low Stock, Upcoming, Overdue, Emergency)

- [x] Store Settings (`/stores/[id]/settings`)
  - Restock settings (cycle days, min/max/ideal stock)
  - Sales velocity input
  - Delivery preferences
  - Seasonal adjustments
  - Notification toggles
  - Contact information management
  - Real-time calculations

---

## 🚧 **In Progress / Next Steps**

### Phase 1B: PWA Foundation (PRIORITY)

#### 1. PWA Setup
- [ ] Install `@vite-pwa/astro` plugin
- [ ] Create `manifest.json` with app metadata
- [ ] Configure service worker for offline support
- [ ] Add app icons (192x192, 512x512, maskable)
- [ ] Add install prompt component
- [ ] Test offline functionality

**Files to Create:**
```
frontend/
├── public/
│   ├── manifest.json
│   ├── pwa-192x192.png
│   ├── pwa-512x512.png
│   ├── pwa-maskable-512x512.png
│   └── sw.js (generated by plugin)
├── src/
│   ├── components/
│   │   ├── InstallPrompt.tsx
│   │   └── OfflineIndicator.tsx
│   └── utils/
│       └── pwa.ts
```

#### 2. Push Notifications Infrastructure
- [ ] Add Web Push API integration
- [ ] Create notification permission request flow
- [ ] Build notification settings component
- [ ] Replace SMS alert approval with Push approval
- [ ] Add notification subscription management
- [ ] Implement notification actions (quick actions)
- [ ] Add notification history/logs

**Features:**
- Permission request with explanation
- Subscription management (enable/disable per store)
- Test notification button
- Notification preview before sending
- Rich notifications with actions
- Badge notifications for counts

**Files to Create:**
```
frontend/src/
├── components/
│   ├── NotificationPermission.tsx
│   ├── NotificationSettings.tsx
│   └── PushNotificationPreview.tsx
├── utils/
│   ├── pushNotifications.ts
│   └── serviceWorkerRegistration.ts
├── pages/
│   ├── notifications/
│   │   ├── settings.astro
│   │   ├── pending.astro (replace /alerts/pending)
│   │   └── history.astro
```

#### 3. Offline Data Strategy
- [ ] Implement IndexedDB for local storage
- [ ] Cache inventory data
- [ ] Queue offline actions
- [ ] Background sync for updates
- [ ] Conflict resolution strategy

**Implementation:**
```typescript
// frontend/src/utils/offlineStorage.ts
import { openDB } from 'idb';

// Cache inventory data
// Queue stock updates when offline
// Sync when connection restored
```

---

## 📱 **Phase 2: Store Manager Portal (PWA-First)**

### Role-Based Access Control (RBAC)
- [ ] Authentication system
  - Email/password login
  - JWT tokens
  - Refresh token flow
  - Logout functionality

- [ ] Authorization middleware
  - Route guards
  - Role checking (admin vs store_manager)
  - Single-store data filtering

- [ ] User management
  - Create store manager accounts
  - Assign stores to users
  - Password reset flow

### Store Manager Dashboard (Mobile-First)
- [ ] Single-store inventory view
  - Current stock display
  - Min/max indicators
  - Next restock date
  - Stock status visualization

- [ ] Quick stock adjustment
  - Add/subtract units
  - Reason selection (sale, damage, count correction)
  - Instant update with optimistic UI

- [ ] Emergency restock button
  - One-tap request
  - Confirmation dialog
  - Push notification to admin

- [ ] Delivery schedule view
  - Next delivery date/time
  - Recent deliveries history
  - Delivery confirmation

### PWA-Optimized UX
- [ ] Bottom navigation for mobile
- [ ] Pull-to-refresh
- [ ] Swipe gestures
- [ ] Large touch targets
- [ ] Simplified layouts
- [ ] Dark mode support

**File Structure:**
```
frontend/src/
├── layouts/
│   └── StoreManagerLayout.astro
├── pages/
│   ├── login.astro
│   ├── store/
│   │   ├── index.astro (dashboard)
│   │   ├── stock.astro
│   │   ├── history.astro
│   │   └── profile.astro
├── components/store/
│   ├── StockCard.tsx
│   ├── QuickAdjust.tsx
│   ├── EmergencyButton.tsx
│   └── DeliverySchedule.tsx
```

---

## 🎨 **Phase 3: UI Polish & Enhancements**

### Missing Features
- [ ] Product management page enhancements
  - Product variants (sizes) as linked products
  - Bulk pricing updates
  - Commission calculator preview
  - Image upload (Cloudinary integration)

- [ ] Transfer history page
  - Filterable table of all transfers
  - Export to CSV
  - Audit trail display

- [ ] Reports & Analytics
  - Stock value over time
  - Restock accuracy
  - Store performance comparison
  - Low stock frequency

- [ ] Distributors page improvements
  - Map view with real geolocation
  - Regional grouping
  - Store performance cards

### UX Improvements
- [ ] Loading states
  - Skeleton screens
  - Progress indicators
  - Optimistic updates

- [ ] Error handling
  - Error boundaries
  - Retry mechanisms
  - User-friendly error messages

- [ ] Animations & Transitions
  - Page transitions
  - Modal animations
  - Toast notifications

- [ ] Accessibility
  - ARIA labels
  - Keyboard navigation
  - Screen reader support
  - Color contrast compliance

### Performance Optimization
- [ ] Code splitting
- [ ] Image optimization
- [ ] Lazy loading
- [ ] Bundle size analysis
- [ ] Lighthouse score optimization

---

## 🔧 **Phase 4: Backend Integration (When Ready)**

### API Development
- [ ] RESTful API endpoints
  - GET /api/inventory
  - POST /api/transfers
  - PUT /api/inventory/:id
  - POST /api/notifications/send

- [ ] Database setup
  - PostgreSQL with schema from DATABASE_SCHEMA_V2.md
  - Migrations
  - Seeders with mock data

- [ ] Authentication API
  - POST /api/auth/login
  - POST /api/auth/refresh
  - POST /api/auth/logout

### Frontend Integration
- [ ] Replace mock data with API calls
- [ ] Add loading/error states
- [ ] Implement data fetching hooks
- [ ] Add optimistic updates
- [ ] Error retry logic

### Push Notifications Backend
- [ ] Web Push server setup
  - VAPID keys generation
  - Subscription storage
  - Push sending endpoint

- [ ] Notification triggers
  - Cron job for scheduled checks
  - Webhook for instant alerts
  - Queue system for batch sending

---

## 📋 **Optional: SMS Fallback (Budget-Dependent)**

**NOTE: Deferred - Keep structure ready but don't implement yet**

- [ ] Twilio integration
  - Account setup
  - Phone number acquisition
  - SMS sending API

- [ ] SMS fallback logic
  - Check if user has PWA + push enabled
  - Send SMS only if push unavailable or critical

- [ ] Cost tracking
  - Log SMS sends
  - Calculate monthly costs
  - Budget alerts

---

## 🎯 **Immediate Next Steps (This Session)**

### Priority 1: PWA Setup
1. Install PWA plugin
2. Create manifest.json
3. Add service worker
4. Create install prompt component
5. Test offline functionality

### Priority 2: Push Notifications
1. Add notification permission flow
2. Create notification settings page
3. Replace SMS approval UI with Push approval
4. Implement test notification feature

### Priority 3: Polish
1. Add loading states to existing pages
2. Improve error handling
3. Add toast notifications
4. Test all existing features

---

## 📦 **Dependencies to Install**

```bash
# PWA
npm install @vite-pwa/astro workbox-window

# Notifications
npm install web-push (backend only)

# Offline Storage
npm install idb

# State Management (optional)
npm install zustand

# Forms & Validation
npm install react-hook-form zod
```

---

## 🧪 **Testing Strategy**

### PWA Testing
- [ ] Test on Chrome (desktop + mobile)
- [ ] Test on Safari (iOS)
- [ ] Test offline mode
- [ ] Test install prompt
- [ ] Test push notifications
- [ ] Test background sync

### Browser Compatibility
- [ ] Chrome/Edge (latest)
- [ ] Safari (latest)
- [ ] Firefox (latest)
- [ ] Mobile browsers (iOS Safari, Chrome Android)

### Accessibility Testing
- [ ] Screen reader testing
- [ ] Keyboard navigation
- [ ] Color contrast
- [ ] WCAG 2.1 AA compliance

---

## 📝 **Documentation Needed**

- [ ] User guide for store managers
- [ ] Admin guide for inventory management
- [ ] API documentation
- [ ] Deployment guide
- [ ] Environment setup guide

---

## 🚀 **Deployment Checklist**

### Pre-Deployment
- [ ] Environment variables configured
- [ ] Production build tested
- [ ] PWA functionality verified
- [ ] Push notifications working
- [ ] Database migrations ready

### Deployment
- [ ] Frontend: Vercel/Netlify
- [ ] Backend: Railway/Render/Fly.io
- [ ] Database: Supabase/Neon PostgreSQL
- [ ] CDN for images: Cloudinary

### Post-Deployment
- [ ] SSL certificate verified
- [ ] PWA installable
- [ ] Notifications working
- [ ] Performance monitoring
- [ ] Error tracking (Sentry)

---

## 🎉 **Success Criteria**

- ✅ Admin can manage inventory from desktop
- ✅ Store managers can install PWA on phone
- ✅ Offline inventory viewing works
- ✅ Push notifications delivered instantly
- ✅ All pages load in <2 seconds
- ✅ Lighthouse score >90
- ✅ Works on iOS and Android
- ✅ No critical bugs

---

**Next Session Focus:** PWA setup and push notifications infrastructure
